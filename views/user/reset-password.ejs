<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kaizen Street</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/imgs/theme/kaizenicon.svg">
    <link rel="stylesheet" href="/css/main.css?v=3.4">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .error-text {
            color: #dc2626;
            font-size: 0.775rem;
            margin-top: 0.25rem;
            display: none;
        }
    </style>
</head>

<body>
    <main class="main">
        <section class="signup-wrapper">
            <div class="container">
                <div class="signup-card mx-auto">
                    <div class="row g-0">

                        <div class="col-lg-6 signup-form-col">
                            <div class="p-4 p-lg-5">
                                <div class="logo-signup-img">
                                    <a href="/"><img src="/imgs/theme/kaizenlogoo.svg" alt="logo"></a>
                                </div>
                                <h3 class="signup-headline mb-4">Reset your password</h3>
                                <p>Enter a new password:</p>


                                <form id="resetForm" novalidate>
                                    <input type="hidden" name="email" value="<%= email %>">
                                    <div class="mb-3">
                                        <input type="password" id="password" name="password"
                                            class="form-control signup-input" placeholder="New Password" required>
                                        <div id="passwordError" class="error-text">Password must be 8+ chars, include
                                            uppercase, lowercase, number, and special char.</div>
                                    </div>
                                    <div class="mb-3">
                                        <input type="password" id="confirmPassword" name="confirmPassword"
                                            class="form-control signup-input" placeholder="Confirm Password" required>
                                        <div id="confirmError" class="error-text">Passwords do not match.</div>
                                    </div>
                                    <div class="d-grid mb-4">
                                        <button type="submit" class="btn btn-signup text-uppercase"
                                            style="max-width:240px; white-space:nowrap; margin:0 auto; display:block; font-size:12px;">Change
                                            Password</button>
                                    </div>
                                    <p class="text-center mt-4 text-muted">
                                        <a href="/login" class="link-login">Back to login</a>
                                    </p>
                                </form>
                            </div>
                        </div>

                        <div class="col-lg-6 signup-form-col">
                            <div class="p-4 p-lg-5 text-center">
                                <img src="/imgs/anime/reset-password.png" alt="Reset Banner" class="img-fluid rounded"
                                    style="max-width: 70%; height: auto; margin-top: 80px;" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="main">
        <div class="container pb-20">
            <div class="row">
                <div class="col-lg-6">
                    <p class="float-md-left font-sm text-muted mb-0">&copy; 2025, <strong class="text-brand">Kaizen
                            Street</strong></p>
                </div>
            </div>
        </div>
    </footer>


    <script>
        document.getElementById('resetForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            document.getElementById('passwordError').style.display = 'none';
            document.getElementById('confirmError').style.display = 'none';

            const form = e.target;
            const email = form.email.value;
            const password = form.password.value;
            const confirm = form.confirmPassword.value;

            const strongRe = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z\d]).{8,}$/;
            let hasError = false;
            if (!strongRe.test(password)) {
                document.getElementById('passwordError').style.display = 'block';
                hasError = true;
            }
            if (password !== confirm) {
                document.getElementById('confirmError').style.display = 'block';
                hasError = true;
            }
            if (hasError) return;

            try {
                const res = await fetch('/reset-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, confirmPassword: confirm })
                });
                const result = await res.json();
                if (!res.ok) throw new Error(result.message || 'Reset failed');
                await Swal.fire({ icon: 'success', title: 'Password Updated!', text: result.message, confirmButtonText: 'Login' });
                window.location.href = '/login';
            } catch (err) {
                Swal.fire({ icon: 'error', title: 'Error', text: err.message });
            }
        });
    </script>

    <script src="/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js?v=3.4"></script>
</body>

</html>